"use strict";const searchForm=document.querySelector(".js-search__form"),searchButton=document.querySelector(".js-search__button"),searchResults=document.querySelector(".js-search__container"),favouriteResults=document.querySelector(".js-favourite__container"),resetButton=document.querySelector(".js-reset__button"),aside=document.querySelector(".js-aside"),menuHamburger=document.querySelector(".js-hamburger"),iconClose=document.querySelector(".js-close"),searchScrolled=document.querySelector(".js-search-scrolled"),onLinkStart=document.querySelector(".js-on--link"),favouriteLink=document.querySelector(".js-favourite--link"),printTextListEmpty='<div class="container__collection">\n  <h2 class="collection__title title capitalize">La lista está vacía</h2>\n  <p class="collection__text">\n    Inicia la búsqueda para agregar series a tu lista.\n  </p>\n  <div class="collection__link button button--contain">\n    <a\n      href="#userSearch"\n      class="error__link--contain uppercase js-favourite--link"\n    >\n      ok\n    </a>\n  </div>';let results=[],favourites=[];function getfavourites(){const e=JSON.parse(localStorage.getItem("favourites"));e&&e.length>0&&(favourites=e,printFavourites(),enableResetButton())}function onSearch(e){e.preventDefault(),clearResults(),getSeries(searchForm.value)}function onReset(e){favourites=[],localStorage.removeItem("favourites"),clearFavourites()}function onMenuChange(e){aside.classList.toggle("js-opened")}function onScroll(e){window.pageYOffset>=200?searchScrolled.style.display="block":searchScrolled.style.display="none"}function clearResults(){searchResults.innerHTML=""}function getSeries(e){fetch("https://api.tvmaze.com/search/shows?q="+e).then(e=>e.json()).then(e=>{results=e,0===e.length?printNotResults():printSeries(e)})}function printSeries(e){const t=document.createElement("ul");t.classList.add("main--list");let s="";e.forEach(e=>{s+=renderSingleElement(e.show)}),t.innerHTML=s,searchResults.appendChild(t),document.querySelectorAll(".js-list--element").forEach(e=>{e.addEventListener("click",onClickSeries)})}function renderSingleElement(e){const t=e.image?e.image.medium:"https://via.placeholder.com/210x295/ffffff/666666/?text="+e.name;let s="";return favourites.find(t=>t.show.id===e.id)&&(s="js-selected"),`<li class="list__element js-list--element ${s}" data-id="${e.id}">\n    <div class="list__container">\n    <img src="${t}" class="list__container--image"/>\n    <i class="list__container--icon icon icon-star fas fa-star"></i>\n    <div>\n    <h3 class="title title--list uppercase">${e.name}</h3>\n    </li>`}function renderFavouriteElement(e){const t=e.image?e.image.medium:"https://via.placeholder.com/210x295/ffffff/666666/?text="+e.name,s=e.genres.length>0?e.genres[0]:"Género no definido",r=e.rating.average?e.rating.average:"No disponible";return`<li class="favourite__list--element">\n    <div class="favourite__container">\n    <img src="${t}" class="favourite__container--image"/>\n    </div>\n    <div class="favourite__paragrah">\n    <h3 class="favourite__paragrah--text title title--small">${e.name}</h3>\n    <i class=" icon icon-trash far fa-trash-alt js-favourite__trash" data-id="${e.id}"></i>\n    <p class="favourite__paragrah--genres"> ${s}</p>\n    <small class="favourite__paragrah--average"> Puntuación: <span>${r}</span></small>\n    </div>\n    </li>`}function printNotResults(){let e=document.createElement("p");e.innerHTML='<div class="container__error">\n    <h2 class="error__title title capitalize"> serie no encontrada </h2>\n    <p class="error__text"> No hay resultados para el valor introducido. Por favor, revisa la búsqueda. </p>\n    <div class="error__link button button--contain"> <a href="#userSearch" class="error__link--contain uppercase js-error--link">ok</a></div>\n    </div>',searchResults.appendChild(e);document.querySelector(".js-error--link").addEventListener("click",e=>{e.preventDefault(),searchForm.focus(),searchForm.value=""})}function onClickSeries(e){e.currentTarget.classList.toggle("js-selected");const t=parseInt(e.currentTarget.dataset.id);let s=results.find(e=>e.show.id===t),r=favourites.findIndex(e=>e.show.id===t);-1===r?(favourites.push(s),enableResetButton()):(favourites.splice(r,1),0===favourites.length&&disableResetButton()),localStorage.setItem("favourites",JSON.stringify(favourites)),printFavourites()}function printFavourites(){favouriteResults.innerHTML="";let e=document.createElement("ul");e.classList.add("favourite__list");let t="";favourites.length<=0&&(favouriteResults.innerHTML=printTextListEmpty);for(const e of favourites)t+=renderFavouriteElement(e.show);e.innerHTML=t,favouriteResults.appendChild(e);document.querySelectorAll(".js-favourite__trash").forEach(e=>{e.addEventListener("click",onTrash)})}function clearFavourites(){favouriteResults.innerHTML="";document.querySelectorAll(".js-selected").forEach(e=>{e.classList.remove("js-selected")}),disableResetButton(),favouriteResults.innerHTML=printTextListEmpty}function onTrash(e){const t=parseInt(e.target.dataset.id);let s=favourites.findIndex(e=>e.show.id===t);favourites.splice(s,1),localStorage.setItem("favourites",JSON.stringify(favourites));const r=document.querySelectorAll(".js-selected");let n=Array.from(r).find(e=>parseInt(e.dataset.id)===t);n&&n.classList.remove("js-selected"),printFavourites(),0===favourites.length&&disableResetButton()}function enableResetButton(){resetButton.removeAttribute("disabled")}function disableResetButton(){resetButton.setAttribute("disabled","")}getfavourites(),searchButton.addEventListener("click",onSearch),resetButton.addEventListener("click",onReset),menuHamburger.addEventListener("click",onMenuChange),iconClose.addEventListener("click",onMenuChange),document.addEventListener("scroll",onScroll),searchScrolled.addEventListener("click",e=>{e.preventDefault(),searchForm.focus()}),onLinkStart.addEventListener("click",e=>{e.preventDefault(),searchForm.focus(),searchForm.value=""}),favouriteLink.addEventListener("click",e=>{e.preventDefault(),searchForm.focus(),searchForm.value=""});